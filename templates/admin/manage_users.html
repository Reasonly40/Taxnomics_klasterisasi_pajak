{% extends "layout.html" %}
{% block title %}Manajemen Akun - TaxNomics{% endblock %}

{% block content %}
<div class="card w-full bg-base-100 shadow-xl">
    <div class="card-body">
        <h1 class="card-title text-2xl text-primary">üõ†Ô∏è Manajemen Akun</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-4 space-y-2">
                    {% for category, message in messages %}
                        <div role="alert" class="alert 
                            {% if category == 'error' %}alert-error
                            {% elif category == 'success' %}alert-success
                            {% else %}alert-info
                            {% endif %} shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            <span>{{ message }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="overflow-x-auto">
            <table class="table table-zebra w-full">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr class="hover">
                        <th>{{ user.id }}</th>
                        <td class="capitalize">{{ user.username }}</td>
                        <td>
                            {% if user.role == 'admin' %}
                                <div class="badge badge-primary badge-outline">Admin</div>
                            {% else %}
                                <div class="badge badge-ghost">Pegawai</div>
                            {% endif %}
                        </td>
                        <td>
                            <div class="flex items-center gap-2">
                                <form method="POST" action="{{ url_for('update_role', user_id=user.id) }}" class="flex items-center gap-2">
                                    <select name="role" class="select select-bordered select-xs">
                                        <option value="pegawai" {% if user.role == 'pegawai' %}selected{% endif %}>Pegawai</option>
                                        <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Admin</option>
                                    </select>
                                    <button type="submit" class="btn btn-warning btn-xs">Update</button>
                                </form>

                                <form method="POST" action="{{ url_for('delete_user', user_id=user.id) }}" 
                                      onsubmit="return confirm('Yakin ingin menghapus user {{ user.username }}?');">
                                    <button type="submit" class="btn btn-error btn-xs">Hapus</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}